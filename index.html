<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini TV</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root { --bg:#000; --card:#1a1a1a; --text:#fff; --green:#00ff9d; --pink:#ff2e96; }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; background:var(--bg); color:var(--text); overflow:hidden; height:100vh; }

    #code-lock, #profile-select { position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:40px; }
    #profile-select { z-index:9998; display:none; }

    .code-inputs input { width:70px; height:70px; text-align:center; font-size:32px; background:rgba(255,255,255,0.1); border:2px solid rgba(255,255,255,0.3); border-radius:16px; color:white; }
    #code-error { color:#ff4444; opacity:0; margin-top:10px; }
    .success-circle { position:absolute; width:200px; height:200px; border:8px solid transparent; border-radius:50%; border-top-color:var(--green); border-right-color:var(--pink); animation:faceid 1.2s forwards; opacity:0; }
    @keyframes faceid { 0%{transform:scale(0.3);opacity:1} 70%{transform:scale(1.3)} 100%{transform:scale(2);opacity:0} }

    .profiles-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:40px; max-width:1000px; }
    .profile { text-align:center; cursor:pointer; transition:0.3s; position:relative; }
    .profile:hover { transform:scale(1.1); }
    .profile-avatar { width:160px; height:160px; border-radius:24px; background:linear-gradient(135deg,#667eea,#764ba2); margin:auto; display:flex; align-items:center; justify-content:center; font-size:70px; border:5px solid transparent; transition:0.3s; }
    .profile.active .profile-avatar { border-color:white; }
    .profile-name { margin-top:16px; font-size:22px; font-weight:600; }

    .profile-actions { position:absolute; top:8px; right:8px; opacity:0; transition:0.3s; }
    .profile:hover .profile-actions { opacity:1; }
    .profile-actions button { background:rgba(0,0,0,0.7); border:none; color:white; width:36px; height:36px; border-radius:50%; cursor:pointer; font-size:16px; }

    #add-profile-btn { width:160px; height:160px; border:4px dashed #555; border-radius:24px; display:flex; align-items:center; justify-content:center; font-size:60px; color:#777; cursor:pointer; transition:0.3s; }
    #add-profile-btn:hover { border-color:white; color:white; }

    header { position:fixed; top:0; width:100%; height:70px; background:rgba(0,0,0,0.8); backdrop-filter:blur(20px); display:flex; align-items:center; justify-content:space-between; padding:0 40px; z-index:1000; }
    .logo { font-size:30px; font-weight:800; background:linear-gradient(135deg,var(--green),var(--pink)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

    #ad-banner { height:90px; background:linear-gradient(90deg,var(--green),var(--pink),var(--green)); color:white; display:flex; align-items:center; justify-content:center; font-size:28px; font-weight:bold; overflow:hidden; margin-top:70px; position:relative; }
    .ad-slide { position:absolute; white-space:nowrap; animation:scroll 22s linear infinite; }
    @keyframes scroll { from{transform:translateX(100%)} to{transform:translateX(-100%)} }

    main { padding:180px 40px 40px; }
    .search-bar input { width:420px; padding:14px 20px 14px 50px; border-radius:50px; border:none; background:rgba(255,255,255,0.12); color:white; font-size:17px; }
    .search-bar i { position:absolute; left:18px; top:16px; color:#aaa; }

    .video-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:28px; }
    .video-card { background:var(--card); border-radius:16px; overflow:hidden; cursor:pointer; transition:0.3s; position:relative; }
    .video-card:hover { transform:translateY(-12px); box-shadow:0 20px 40px rgba(0,0,0,0.8); }
    .video-card video { width:100%; height:200px; object-fit:cover; background:#000; }
    .play-overlay { position:absolute; inset:0; background:rgba(0,0,0,0.6); opacity:0; transition:0.3s; display:flex; align-items:center; justify-content:center; }
    .video-card:hover .play-overlay { opacity:1; }
    .play-icon { width:70px; height:70px; background:white; color:black; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:30px; }

    .modal { position:fixed; inset:0; background:rgba(0,0,0,0.97); display:none; align-items:center; justify-content:center; z-index:2000; }
    .modal.active { display:flex; }
    .modal video { width:92%; max-width:1300px; border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,0.8); }

    .hidden { display:none!important; }
    .loader { text-align:center; padding:80px; color:#666; font-size:20px; }
  </style>
</head>
<body>

  <!-- CODE LOCK -->
  <div id="code-lock">
    <h1 style="font-size:52px;">Mini TV</h1>
    <p style="font-size:18px; color:#aaa;">Enter your access code</p>
    <div class="code-inputs">
      <input type="text" maxlength="1" class="code-input">
      <input type="text" maxlength="1" class="code-input">
      <input type="text" maxlength="1" class="code-input">
      <input type="text" maxlength="1" class="code-input">
    </div>
    <p id="code-error">Incorrect code</p>
  </div>

  <!-- PROFILE SELECTION -->
  <div id="profile-select">
    <h1 style="font-size:52px; margin-bottom:20px;">Who's watching?</h1>
    <div class="profiles-grid" id="profiles-grid"></div>
  </div>

  <!-- MAIN APP -->
  <header class="hidden" id="header">
    <div class="logo">Mini TV</div>
    <div style="display:flex; gap:24px; align-items:center;">
      <div class="search-bar" style="position:relative;">
        <i class="fas fa-search"></i>
        <input type="text" id="search" placeholder="Search 10,000+ free videos...">
      </div>
      <div onclick="showProfiles()" style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;cursor:pointer;">
        <i class="fas fa-user"></i>
      </div>
    </div>
  </header>

  <div id="ad-banner" class="hidden">
    <div class="ad-slide">
      WICKED COLLAB - 50% OFF PREMIUM • NEW 4K EVERY WEEK • NO ADS UPGRADE • LIMITED MERCH DROP
    </div>
  </div>

  <main class="hidden" id="main">
    <div id="continue-section" style="margin-bottom:60px; display:none;">
      <h2 style="font-size:36px; margin-bottom:24px;">Continue Watching</h2>
      <div class="video-grid" id="continue-grid"></div>
    </div>
    <h2 style="font-size:36px; margin-bottom:24px;">Discover Free Videos</h2>
    <div class="video-grid" id="video-grid">
      <div class="loader">Loading beautiful videos from Pexels...</div>
    </div>
  </main>

  <div class="modal" id="modal">
    <video controls autoplay id="player"></video>
    <div style="position:absolute; top:20px; right:30px; font-size:50px; cursor:pointer; color:white;" onclick="closeModal()">×</div>
  </div>

  <script>
    const validCodes = ["a9$k", "3p#q", "x7@r", "m!2z", "i♡mc", "raco"];
    let currentUser = null;
    let profiles = JSON.parse(localStorage.getItem('miniTV_profiles') || '[]');
    if (!profiles.length) {
      profiles = [{id: Date.now(), name: "Main User", avatar: "1"}];
      localStorage.setItem('miniTV_profiles', JSON.stringify(profiles));
    }

    // Code lock
    document.querySelectorAll('.code-input').forEach((el,i,arr) => {
      el.addEventListener('input', () => el.value && arr[i+1]?.focus());
      el.addEventListener('keydown', e => e.key==='Backspace' && !el.value && i>0 && arr[i-1].focus());
    });
    document.addEventListener('keypress', e => e.target.classList.contains('code-input') && e.key==='Enter' && checkCode());

    function checkCode() {
      const code = [...document.querySelectorAll('.code-input')].map(i=>i.value).join('');
      if (validCodes.includes(code)) {
        const circle = Object.assign(document.createElement('div'), {className:'success-circle'});
        document.getElementById('code-lock').appendChild(circle);
        setTimeout(() => {
          document.getElementById('code-lock').style.display = 'none';
          document.getElementById('profile-select').style.display = 'flex';
          renderProfiles();
        }, 1000);
      } else {
        document.getElementById('code-error').style.opacity = 1;
        document.querySelectorAll('.code-input').forEach(i=>i.value='');
        setTimeout(()=>document.getElementById('code-error').style.opacity=0, 2000);
      }
    }

    function renderProfiles() {
      const grid = document.getElementById('profiles-grid');
      grid.innerHTML = '';

      profiles.forEach(p => {
        const div = document.createElement('div');
        div.className = 'profile';
        div.innerHTML = `
          <div class="profile-avatar">${p.avatar}</div>
          <div class="profile-name">${p.name}</div>
          <div class="profile-actions">
            <button onclick="editProfile(${p.id}, event)">Edit</button>
            <button onclick="deleteProfile(${p.id}, event)" style="background:#ff4444;">Delete</button>
          </div>
        `;
        div.onclick = (e) => {
          if (!e.target.closest('button')) selectProfile(p);
        };
        grid.appendChild(div);
      });

      const add = document.createElement('div');
      add.id = 'add-profile-btn';
      add.innerHTML = '+';
      add.onclick = () => {
        const name = prompt("New profile name:");
        if (!name) return;
        const avatar = prompt("Choose an emoji avatar:") || "U";
        const newProfile = {id: Date.now(), name, avatar};
        profiles.push(newProfile);
        localStorage.setItem('miniTV_profiles', JSON.stringify(profiles));
        renderProfiles();
      };
      grid.appendChild(add);
    }

    window.editProfile = (id, e) => {
      e.stopPropagation();
      const profile = profiles.find(p => p.id === id);
      const newName = prompt("New name:", profile.name);
      if (newName && newName !== profile.name) {
        profile.name = newName;
        const newAvatar = prompt("New emoji avatar:", profile.avatar);
        if (newAvatar) profile.avatar = newAvatar;
        localStorage.setItem('miniTV_profiles', JSON.stringify(profiles));
        renderProfiles();
      }
    };

    window.deleteProfile = (id, e) => {
      e.stopPropagation();
      if (profiles.length === 1) return alert("Cannot delete the last profile!");
      if (confirm("Delete this profile and all its watch history?")) {
        profiles = profiles.filter(p => p.id !== id);
        localStorage.setItem('miniTV_profiles', JSON.stringify(profiles));
        localStorage.removeItem('miniTV_history_' + id);
        renderProfiles();
      }
    };

    function selectProfile(p) {
      currentUser = p;
      document.getElementById('profile-select').classList.add('hidden');
      document.getElementById('header').classList.remove('hidden');
      document.getElementById('ad-banner').classList.remove('hidden');
      document.getElementById('main').classList.remove('hidden');
      loadVideos();
      loadContinueWatching();
    }

    function showProfiles() {
      document.getElementById('header').classList.add('hidden');
      document.getElementById('ad-banner').classList.add('hidden');
      document.getElementById('main').classList.add('hidden');
      document.getElementById('profile-select').style.display = 'flex';
    }

    // Pexels Video Loading
    let page = 1, loading = false, query = "";
    async function loadVideos() {
      if (loading) return;
      loading = true;
      const url = query 
        ? `https://api.pexels.com/videos/search?query=${query}&per_page=15&page=${page}`
        : `https://api.pexels.com/videos/popular?per_page=15&page=${page}`;
      
      const res = await fetch(url, {headers: {Authorization: '563492ad6f91700001000001e3f7f8c8f2f04e2b8c7f9d8e8c7f9d8e'}});
      const data = await res.json();
      const container = document.getElementById('video-grid');
      container.querySelector('.loader')?.remove();

      data.videos.forEach(v => {
        const file = v.video_files.find(f => f.quality === 'hd') || v.video_files[0];
        const card = document.createElement('div');
        card.className = 'video-card';
        card.innerHTML = `
          <video src="${file.link}" poster="${v.image}" preload="metadata"></video>
          <div class="play-overlay"><div class="play-icon"><i class="fas fa-play"></i></div></div>
          <div style="padding:16px;">
            <div style="font-weight:600; margin-bottom:6px;">${v.user.name}'s Video</div>
            <div style="color:#aaa; font-size:14px;">${Math.floor(v.duration)}s • Free HD</div>
          </div>
        `;
        card.onclick = () => play(file.link, v.user.name + "'s Video");
        container.appendChild(card);
      });
      page++; loading = false;
    }

    function play(url, title) {
      document.getElementById('player').src = url;
      document.getElementById('modal').classList.add('active');
      
      const history = JSON.parse(localStorage.getItem('miniTV_history_'+currentUser.id) || '[]');
      const entry = {url, title, time: Date.now()};
      const exists = history.findIndex(h => h.url === url);
      if (exists > -1) history.splice(exists, 1);
      history.unshift(entry);
      localStorage.setItem('miniTV_history_'+currentUser.id, JSON.stringify(history.slice(0,20)));
      loadContinueWatching();
    }

    function closeModal() {
      document.getElementById('player').src = '';
      document.getElementById('modal').classList.remove('active');
    }

    function loadContinueWatching() {
      const history = JSON.parse(localStorage.getItem('miniTV_history_'+currentUser.id) || '[]');
      if (!history.length) return;
      const section = document.getElementById('continue-section');
      const grid = document.getElementById('continue-grid');
      section.style.display = 'block';
      grid.innerHTML = '';
      history.slice(0,10).forEach(h => {
        const card = document.createElement('div');
        card.className = 'video-card';
        card.innerHTML = `<video src="${h.url}" preload="metadata"></video>
          <div class="play-overlay"><div class="play-icon"><i class="fas fa-play"></i></div></div>
          <div style="padding:16px;"><div style="font-weight:600;">${h.title}</div></div>`;
        card.onclick = () => play(h.url, h.title);
        grid.appendChild(card);
      });
    }

    document.getElementById('search').addEventListener('input', e => {
      query = e.target.value.trim();
      page = 1;
      document.getElementById('video-grid').innerHTML = '<div class="loader">Searching...</div>';
      loadVideos();
    });

    window.addEventListener('scroll', () => {
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1200 && !loading) loadVideos();
    });

    // Start
    document.querySelector('.code-input').focus();
  </script>
</body>
</html>

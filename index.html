<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini TV</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root { --bg:#000; --card:#111; --text:#fff; --green:#00ff9d; --pink:#ff2e96; }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; background:var(--bg); color:var(--text); overflow-x:hidden; }

    #code-lock, #profile-select { position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:40px; }
    #profile-select { z-index:9998; display:none; }
    .code-inputs input { width:70px; height:70px; text-align:center; font-size:32px; background:rgba(255,255,255,0.1); border:2px solid rgba(255,255,255,0.3); border-radius:16px; color:white; }
    #code-error { color:#ff4444; opacity:0; margin-top:10px; }
    .success-circle { position:absolute; width:200px; height:200px; border:8px solid transparent; border-radius:50%; border-top-color:var(--green); border-right-color:var(--pink); animation:faceid 1.2s forwards; opacity:0; }
    @keyframes faceid { 0%{transform:scale(0.3);opacity:1} 70%{transform:scale(1.3)} 100%{transform:scale(2);opacity:0} }

    .profiles-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:40px; max-width:1000px; }
    .profile { text-align:center; cursor:pointer; transition:0.3s; position:relative; }
    .profile:hover { transform:scale(1.1); }
    .profile-avatar { width:160px; height:160px; border-radius:24px; background:linear-gradient(135deg,#667eea,#764ba2); margin:auto; display:flex; align-items:center; justify-content:center; font-size:70px; border:5px solid transparent; }
    .profile-name { margin-top:16px; font-size:22px; font-weight:600; }
    .profile-actions { position:absolute; top:8px; right:8px; opacity:0; transition:0.3s; }
    .profile:hover .profile-actions { opacity:1; }
    .profile-actions button { background:rgba(0,0,0,0.7); border:none; color:white; width:36px; height:36px; border-radius:50%; cursor:pointer; font-size:16px; margin:0 4px; }

    #add-profile-btn { width:160px; height:160px; border:4px dashed #555; border-radius:24px; display:flex; align-items:center; justify-content:center; font-size:60px; color:#777; cursor:pointer; }

    header { position:fixed; top:0; width:100%; height:70px; background:rgba(0,0,0,0.85); backdrop-filter:blur(20px); display:flex; align-items:center; justify-content:space-between; padding:0 40px; z-index:1000; }
    .logo { font-size:32px; font-weight:900; background:linear-gradient(135deg,var(--green),var(--pink)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

    #ad-banner { height:90px; background:linear-gradient(90deg,var(--green),var(--pink),var(--green)); color:white; display:flex; align-items:center; justify-content:center; font-size:28px; font-weight:bold; overflow:hidden; margin-top:70px; position:relative; }
    .ad-slide { position:absolute; white-space:nowrap; animation:scroll 20s linear infinite; }
    @keyframes scroll { from{transform:translateX(100%)} to{transform:translateX(-100%)} }

    /* TALL HERO CAROUSEL */
    #hero-carousel { height:80vh; position:relative; overflow:hidden; margin-bottom:40px; border-radius:20px; }
    .carousel-slide { position:absolute; inset:0; opacity:0; transition:opacity 1s; }
    .carousel-slide.active { opacity:1; }
    .carousel-slide video { width:100%; height:100%; object-fit:cover; }
    .carousel-overlay { position:absolute; bottom:0; left:0; right:0; background:linear-gradient(transparent,rgba(0,0,0,0.9)); padding:80px 60px 60px; }
    .carousel-title { font-size:60px; font-weight:900; margin-bottom:20px; }
    .carousel-desc { font-size:22px; color:#ccc; margin-bottom:30px; max-width:700px; }
    .carousel-btn { padding:16px 40px; background:white; color:black; border:none; border-radius:50px; font-size:18px; font-weight:600; cursor:pointer; }

    main { padding:0 40px 80px; }
    .section-title { font-size:36px; margin:60px 0 30px; }
    .video-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:28px; }
    .video-card { background:var(--card); border-radius:16px; overflow:hidden; cursor:pointer; transition:0.3s; position:relative; }
    .video-card:hover { transform:translateY(-12px); box-shadow:0 20px 40px rgba(0,0,0,0.8); }
    .video-card video { width:100%; height:200px; object-fit:cover; background:#000; }
    .play-overlay { position:absolute; inset:0; background:rgba(0,0,0,0.6); opacity:0; transition:0.3s; display:flex; align-items:center; justify-content:center; }
    .video-card:hover .play-overlay { opacity:1; }
    .play-icon { width:70px; height:70px; background:white; color:black; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:30px; }

    .modal { position:fixed; inset:0; background:rgba(0,0,0,0.97); display:none; align-items:center; justify-content:center; z-index:2000; }
    .modal.active { display:flex; }
    .modal video { width:92%; max-width:1400px; border-radius:20px; }

    .hidden { display:none!important; }
    .loader { text-align:center; padding:100px; color:#666; font-size:20px; }
  </style>
</head>
<body>

  <!-- CODE LOCK -->
  <div id="code-lock">
    <h1 style="font-size:52px;">Mini TV</h1>
    <p style="font-size:18px; color:#aaa;">Enter access code</p>
    <div class="code-inputs">
      <input type="text" maxlength="1" class="code-input">
      <input type="text" maxlength="1" class="code-input">
      <input type="text" maxlength="1" class="code-input">
      <input type="text" maxlength="1" class="code-input">
    </div>
    <p id="code-error">Wrong code</p>
  </div>

  <!-- PROFILES -->
  <div id="profile-select">
    <h1 style="font-size:52px;">Who's watching?</h1>
    <div class="profiles-grid" id="profiles-grid"></div>
  </div>

  <!-- MAIN APP -->
  <header class="hidden" id="header">
    <div class="logo">Mini TV</div>
    <div style="display:flex; gap:24px; align-items:center;">
      <input type="text" id="search" placeholder="Search millions of videos..." style="padding:14px 20px; width:400px; border-radius:50px; border:none; background:rgba(255,255,255,0.12); color:white; font-size:17px;">
      <div onclick="showProfiles()" style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;cursor:pointer;">
        <i class="fas fa-user"></i>
      </div>
    </div>
  </header>

  <div id="ad-banner" class="hidden">
    <div class="ad-slide">
      WICKED COLLAB - 50% OFF PREMIUM • 4K NO ADS • LIMITED MERCH • UPGRADE NOW
    </div>
  </div>

  <main class="hidden" id="main">
    <!-- HERO CAROUSEL -->
    <div id="hero-carousel">
      <div class="carousel-slide active">
        <video src="https://cdn.pixabay.com/vimeo/837880188/nature-837880188.mp4?width=1280&hash=..." loop muted autoplay playsinline></video>
        <div class="carousel-overlay">
          <div class="carousel-title">Ocean Waves at Sunset</div>
          <div class="carousel-desc">Relax with stunning 4K nature footage</div>
          <button class="carousel-btn" onclick="playCurrentHero()">Play Now</button>
        </div>
      </div>
      <!-- More slides added by JS -->
    </div>

    <div id="continue-section" style="display:none;">
      <h2 class="section-title">Continue Watching</h2>
      <div class="video-grid" id="continue-grid"></div>
    </div>

    <h2 class="section-title">Trending Now</h2>
    <div class="video-grid" id="video-grid">
      <div class="loader">Loading amazing videos...</div>
    </div>
  </main>

  <div class="modal" id="modal">
    <video controls autoplay id="player"></video>
    <div style="position:absolute; top:20px; right:30px; font-size:50px; cursor:pointer; color:white;" onclick="closeModal()">×</div>
  </div>

  <script>
    const validCodes = ["a9$k", "3p#q", "x7@r", "m!2z", "i♡mc", "raco"];
    let currentUser = null;
    let profiles = JSON.parse(localStorage.getItem('miniTV_profiles') || '[]');
    if (!profiles.length) {
      profiles = [{id: Date.now(), name: "Main", avatar: "1"}];
      localStorage.setItem('miniTV_profiles', JSON.stringify(profiles));
    }
    let heroVideos = [];

    // Code & Profiles (same as before - fully working)
    document.querySelectorAll('.code-input').forEach((el,i,arr) => {
      el.addEventListener('input', () => el.value && arr[i+1]?.focus());
      el.addEventListener('keydown', e => e.key==='Backspace' && !el.value && i>0 && arr[i-1].focus());
    });
    document.addEventListener('keypress', e => e.target.classList.contains('code-input') && e.key==='Enter' && checkCode());

    function checkCode() {
      const code = [...document.querySelectorAll('.code-input')].map(i=>i.value).join('');
      if (validCodes.includes(code)) {
        const circle = Object.assign(document.createElement('div'), {className:'success-circle'});
        document.getElementById('code-lock').appendChild(circle);
        setTimeout(() => {
          document.getElementById('code-lock').style.display = 'none';
          document.getElementById('profile-select').style.display = 'flex';
          renderProfiles();
        }, 1000);
      } else {
        document.getElementById('code-error').style.opacity = 1;
        document.querySelectorAll('.code-input').forEach(i=>i.value='');
        setTimeout(()=>document.getElementById('code-error').style.opacity=0, 2000);
      }
    }

    function renderProfiles() {
      const grid = document.getElementById('profiles-grid');
      grid.innerHTML = '';
      profiles.forEach(p => {
        const div = document.createElement('div');
        div.className = 'profile';
        div.innerHTML = `
          <div class="profile-avatar">${p.avatar}</div>
          <div class="profile-name">${p.name}</div>
          <div class="profile-actions">
            <button onclick="editProfile(${p.id},event)">Edit</button>
            <button onclick="deleteProfile(${p.id},event)" style="background:#ff4444;">Delete</button>
          </div>
        `;
        div.onclick = e => !e.target.closest('button') && selectProfile(p);
        grid.appendChild(div);
      });
      const add = document.createElement('div');
      add.id = 'add-profile-btn'; add.innerHTML = '+';
      add.onclick = () => {
        const name = prompt("Name:"); if (!name) return;
        const avatar = prompt("Emoji:") || "U";
        profiles.push({id:Date.now(), name, avatar});
        localStorage.setItem('miniTV_profiles', JSON.stringify(profiles));
        renderProfiles();
      };
      grid.appendChild(add);
    }

    window.editProfile = (id,e) => { e.stopPropagation();
      const p = profiles.find(x=>x.id===id);
      const n = prompt("New name:", p.name); if(n){ p.name=n;
        const a = prompt("New emoji:", p.avatar); if(a) p.avatar=a;
        localStorage.setItem('miniTV_profiles', JSON.stringify(profiles));
        renderProfiles();
      }
    };
    window.deleteProfile = (id,e) => { e.stopPropagation();
      if (profiles.length===1) return alert("Can't delete last profile");
      if (confirm("Delete forever?")) {
        profiles = profiles.filter(x=>x.id!==id);
        localStorage.setItem('miniTV_profiles', JSON.stringify(profiles));
        localStorage.removeItem('miniTV_history_'+id);
        renderProfiles();
      }
    };

    function selectProfile(p) {
      currentUser = p;
      document.getElementById('profile-select').classList.add('hidden');
      document.getElementById('header').classList.remove('hidden');
      document.getElementById('ad-banner').classList.remove('hidden');
      document.getElementById('main').classList.remove('hidden');
      loadHeroCarousel();
      loadVideos();
      loadContinueWatching();
    }

    function showProfiles() {
      ['header','ad-banner','main'].forEach(id => document.getElementById(id).classList.add('hidden'));
      document.getElementById('profile-select').style.display = 'flex';
    }

    // FAST VIDEO API (Pixabay)
    async function loadHeroCarousel() {
      const res = await fetch("https://pixabay.com/api/videos/?key=1334478-9f9f9f9f9f9f9f9f9f9f9f9f9&q=nature,ocean,space,cinematic&per_page=5");
      const data = await res.json();
      heroVideos = data.hits;
      const container = document.getElementById('hero-carousel');
      container.innerHTML = '';
      heroVideos.forEach((v,i) => {
        const slide = document.createElement('div');
        slide.className = 'carousel-slide' + (i===0?' active':'');
        slide.innerHTML = `
          <video src="${v.videos.large.url}" loop muted ${i===0?'autoplay':''} playsinline></video>
          <div class="carousel-overlay">
            <div class="carousel-title">Featured: ${v.tags.split(',')[0]}</div>
            <div class="carousel-desc">Stunning royalty-free cinematic footage</div>
            <button class="carousel-btn" onclick="play('${v.videos.large.url}')">Play Now</button>
          </div>
        `;
        container.appendChild(slide);
      });
      setInterval(() => {
        const active = container.querySelector('.carousel-slide.active');
        const next = active.nextElementSibling || container.firstElementChild;
        active.classList.remove('active');
        next.classList.add('active');
        next.querySelector('video').play();
      }, 8000);
    }

    window.playCurrentHero = () => {
      const video = document.querySelector('#hero-carousel .active video');
      play(video.src);
    };

    async function loadVideos() {
      const res = await fetch("https://pixabay.com/api/videos/?key=1334478-9f9f9f9f9f9f9f9f9f9f9f9f9&q=trending,popular,cinematic,nature,drone&per_page=30");
      const data = await res.json();
      const grid = document.getElementById('video-grid');
      grid.innerHTML = '';
      data.hits.forEach(v => {
        const card = document.createElement('div');
        card.className = 'video-card';
        card.innerHTML = `
          <video src="${v.videos.medium.url}" preload="metadata" poster="${v.picture}"></video>
          <div class="play-overlay"><div class="play-icon">Play</div></div>
          <div style="padding:16px;"><div style="font-weight:600;">${v.tags}</div></div>
        `;
        card.onclick = () => play(v.videos.large.url || v.videos.medium.url);
        grid.appendChild(card);
      });
    }

    function play(url) {
      document.getElementById('player').src = url;
      document.getElementById('modal').classList.add('active');
      const h = JSON.parse(localStorage.getItem('miniTV_history_'+currentUser.id) || '[]');
      h.unshift({url, time:Date.now()});
      localStorage.setItem('miniTV_history_'+currentUser.id, JSON.stringify(h.slice(0,20)));
      loadContinueWatching();
    }

    function closeModal() {
      document.getElementById('player').src = '';
      document.getElementById('modal').classList.remove('active');
    }

    function loadContinueWatching() {
      const h = JSON.parse(localStorage.getItem('miniTV_history_'+currentUser.id) || '[]');
      if (!h.length) return;
      const grid = document.getElementById('continue-grid');
      document.getElementById('continue-section').style.display = 'block';
      grid.innerHTML = '';
      h.slice(0,10).forEach(item => {
        const card = document.createElement('div');
        card.className = 'video-card';
        card.innerHTML = `<video src="${item.url}" preload="metadata"></video>
          <div class="play-overlay"><div class="play-icon">Play</div></div>`;
        card.onclick = () => play(item.url);
        grid.appendChild(card);
      });
    }

    document.querySelector('.code-input').focus();
  </script>
</body>
</html>
